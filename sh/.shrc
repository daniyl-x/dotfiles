#       _              
#   ___| |__  _ __ ___ 
#  / __| '_ \| '__/ __|
# _\__ \ | | | | | (__ 
#(_)___/_| |_|_|  \___|
                      
# SPDX-License-Identifier: BSD-2-Clause

# Copyright (c) 2023-2025, daniyl-x
                              

### FUNCTIONS ###

# Name of the current dir
cwd(){
    case "$PWD" in
        "/") printf "%s" "$PWD" ;;
        "$HOME") printf "~" ;;
        *) printf "%s" "${PWD##*/}" ;;
    esac
}

# Replace $HOME in path with ~
spwd(){
    _spwd="${PWD#$HOME}"
    [ "$_spwd" != "$PWD" ] && printf "~%s" "$_spwd" || printf "%s" "$PWD"
}

# Trim path $1 to length $2 replacing the rest with ... and preserving ~
dirtrim(){
    if [ "$1" = "~" ] || [ "$1" = "/" ]; then printf "%s" "$1"; return 0; fi

    _has_home=0
    [ "${1#"~"}" != "$1" ] && _has_home=1
    _depth=${2:-4}
    _trimmed="$(printf '%s' $1 | rev | cut -d / -f -$_depth | rev)"

    set -f
    _old_ifs=$IFS
    IFS="/"
    set -- $1
    IFS=$_old_ifs
    set +f

    _trimmed="${_trimmed##"~"}"; _trimmed="${_trimmed##"/"}"
    _trimmed="/${_trimmed}"
    [ "$#" -gt $((_depth + 1)) ] && _trimmed="/...${_trimmed}"
    [ "$_has_home" -eq 1 ] && _trimmed="~${_trimmed}"

    printf "%s" "$_trimmed"
}

is_present(){
    command -v $1 > /dev/null 2>&1
}

# Git branch function for prompt
git_branch(){
    if is_present git; then
        git branch 2> /dev/null | sed -e "/^[^*]/d" -e "s/* \(.*\)/ (\1)/"
    fi
}


### VARIABLES ###

export HISTSIZE=10000           # history size
export GPG_TTY=$(tty)           # gpg-agent tty


### PROMPT ###

# Colors
ESC="\033[0;"
RST="${ESC}0m"
RED="${ESC}31m"
GREEN="${ESC}32m"
BLUE="${ESC}34m"
PURPLE="${ESC}35m"
CYAN="${ESC}36m"

# Unicode symbols
BOX_H="\342\224\200"
BOX_DR="\342\224\214"
BOX_UR="\342\224\224"

# Set of 'user@host' and prompt symbol for root/non-root
IDCOL=$GREEN
IDSYM="\$"
if [ "$(id -u)" -eq 0 ]; then
    IDCOL=$RED
    IDSYM="#"
fi

# Git Bash Style Prompt
GIT_BASH_PS1="\n${IDCOL}${USER}@${HOSTNAME}${RST}:${CYAN}\$(dirtrim \$(spwd))${PURPLE}\$(git_branch)${RST}\n${IDSYM} "
# One Long Line Prompt
ONE_LINE_PS1="${IDCOL}${USER}@${HOSTNAME}${RST}:${CYAN}\$(dirtrim \$(spwd))${PURPLE}\$(git_branch)${RST}${IDSYM} "
# Fedora Style Prompt
FEDORA_PS1="${BLUE}[${IDCOL}${USER}@${HOSTNAME}${RST}: ${CYAN}\$(cwd)${BLUE}]${PURPLE}\$(git_branch)${RST}${IDSYM} "
# Two line, square box
TWO_LINE_PS1="\n${BOX_DR}${BOX_H}${BLUE}[${IDCOL}${USER}@${HOSTNAME}${RST}: ${CYAN}\$(dirtrim \$(spwd))${BLUE}]${PURPLE}\$(git_branch)\n${RST}${BOX_UR}${BLUE}${IDSYM}${RST} "

# Choose PS1 from above options
PS1="$TWO_LINE_PS1"

# Pre-interpret escape sequences in PS1
export PS1=$(printf "%b" "$PS1")


### MISC ###

# Set vi mode
set -o vi

# Aliases
. "${HOME}/.aliases"

